<section
  id="projects"
  class="w-full text-white flex flex-col items-center justify-center px-2 xs:px-4 sm:px-6 lg:px-8 py-8 xs:py-10 sm:py-12 md:py-16 lg:py-20 relative"
  [style.min-height]="'100vh'"
>
  <div
    class="max-w-xs xs:max-w-sm sm:max-w-2xl md:max-w-4xl lg:max-w-6xl xl:max-w-7xl w-full"
  >
    <!-- Section Title -->
    <div class="text-center mb-8 xs:mb-10 sm:mb-12 md:mb-14 lg:mb-16">
      <h2
        class="text-2xl xs:text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold mb-2 xs:mb-3 sm:mb-4 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 animate-pulse leading-tight"
      >
        Projects
      </h2>
      <p
        class="text-gray-300 hover:text-gray-200 transition-colors duration-300 text-sm xs:text-base sm:text-lg md:text-xl max-w-xs xs:max-w-sm sm:max-w-2xl mx-auto px-2 sm:px-0 leading-relaxed"
      >
        Explore my featured work showcasing modern web development and creative
        solutions
      </p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-20">
      <div class="text-center">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mb-4"
        ></div>
        <p class="text-gray-300">Loading projects...</p>
      </div>
    </div>

    <!-- Projects Carousel Container -->
    <div
      *ngIf="!isLoading"
      class="relative overflow-hidden mb-8 xs:mb-10 sm:mb-12 md:mb-14 lg:mb-16"
    >
      <!-- No Projects Message -->
      <div *ngIf="featuredProjects.length === 0" class="text-center py-20">
        <div class="text-gray-400 mb-4">
          <svg
            class="w-16 h-16 mx-auto mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a1 1 0 011-1h6a1 1 0 011 1v2M7 7h10"
            ></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-300 mb-2">
          No Projects Yet
        </h3>
        <p class="text-gray-400">
          Projects will appear here once uploaded through the admin panel.
        </p>
      </div>

      <!-- Carousel Track -->
      <div
        *ngIf="featuredProjects.length > 0"
        class="flex transition-transform duration-500 ease-in-out"
        [style.transform]="'translateX(-' + currentIndex * slideWidth + '%)'"
      >
        <!-- Project Card Loop -->
        <div
          *ngFor="
            let project of featuredProjects;
            let i = index;
            trackBy: trackByProjectId
          "
          class="group relative flex-shrink-0"
          [style.width]="slideWidth + '%'"
        >
          <div class="mx-1 xs:mx-2 sm:mx-3 lg:mx-4 h-full">
            <div
              class="bg-gray-900/40 backdrop-blur-sm border border-gray-700/50 hover:border-{{
                project.borderColors[0]
              }}/50 rounded-lg xs:rounded-xl sm:rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl hover:shadow-{{
                project.borderColors[0]
              }}/10 transition-all duration-500 group-hover:scale-[1.01] xs:group-hover:scale-[1.02] flex flex-col h-[520px]"
            >
              <!-- Dynamic Glow Effect -->
              <div
                class="absolute inset-0 bg-gradient-to-r {{
                  project.gradients.card
                }} rounded-lg xs:rounded-xl sm:rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"
              ></div>

              <!-- Project Image - Fixed Height -->
              <div class="relative overflow-hidden flex-shrink-0 h-[200px]">
                <div
                  class="w-full h-full bg-gradient-to-br {{
                    project.gradients.image
                  }} flex items-center justify-center relative"
                >
                  <!-- Project Image or Emoji -->
                  <div
                    *ngIf="!project.image; else projectImage"
                    class="text-5xl opacity-50"
                  >
                    {{ project.emoji }}
                  </div>
                  <ng-template #projectImage>
                    <img
                      [src]="project.image"
                      [alt]="project.alt"
                      class="w-full h-full object-cover"
                      loading="lazy"
                      (error)="project.image = ''"
                    />
                  </ng-template>

                  <!-- Desktop Hover Overlay with Dynamic Buttons (hidden on mobile) -->
                  <div
                    class="hidden sm:flex absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 items-end justify-center pb-4"
                  >
                    <div class="flex flex-wrap justify-center gap-2 px-2">
                      <button
                        *ngFor="let button of project.buttons"
                        (click)="onProjectButtonClick(project, button.text)"
                        class="px-3 py-2 {{
                          button.bgColor
                        }} backdrop-blur-sm border {{
                          button.borderColor
                        }} rounded-lg {{
                          button.textColor
                        }} text-sm font-medium {{
                          button.hoverBgColor
                        }} transition-all duration-300 whitespace-nowrap"
                      >
                        {{ button.text }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Project Content - Flexible Height -->
              <div
                class="relative z-10 p-4 sm:p-5 flex-1 flex flex-col min-h-0"
              >
                <!-- Dynamic Project Title - Max 2 Lines -->
                <h3
                  class="text-lg sm:text-xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r {{
                    project.gradients.title
                  }} {{
                    project.gradients.titleHover
                  }} transition-all duration-300 leading-tight overflow-hidden"
                  style="
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                  "
                >
                  {{ project.title }}
                </h3>

                <!-- Dynamic Project Description - Max 2 Lines -->
                <div
                  class="text-gray-300 hover:text-gray-200 transition-colors duration-300 leading-relaxed mb-3 text-sm overflow-hidden"
                  style="
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                  "
                  [innerHTML]="project.description"
                ></div>

                <!-- Dynamic Tech Stack (Limited to 4) -->
                <div class="flex flex-wrap gap-1.5 mb-3">
                  <span
                    *ngFor="let tech of project.techStack.slice(0, 4)"
                    class="px-2 py-1 bg-gradient-to-r {{
                      tech.gradient
                    }} border {{ tech.borderColor }} rounded-full {{
                      tech.textColor
                    }} text-xs font-medium {{
                      tech.hoverGradient
                    }} hover:scale-105 transition-all duration-300 backdrop-blur-sm whitespace-nowrap"
                  >
                    {{ tech.name }}
                  </span>
                  <span
                    *ngIf="project.techStack.length > 4"
                    class="px-2 py-1 bg-gray-700/50 border border-gray-600 rounded-full text-gray-400 text-xs font-medium"
                  >
                    +{{ project.techStack.length - 4 }}
                  </span>
                </div>

                <!-- Spacer to push buttons to bottom -->
                <div class="flex-1 min-h-0"></div>

                <!-- Mobile Action Buttons (only visible on mobile) -->
                <div class="sm:hidden flex flex-wrap gap-2 mb-3 relative z-30">
                  <button
                    *ngFor="let button of project.buttons"
                    (click)="onProjectButtonClick(project, button.text)"
                    (touchstart)="$event.stopPropagation()"
                    (touchend)="$event.stopPropagation()"
                    class="flex-1 min-w-0 px-3 py-2 {{
                      button.bgColor
                    }} backdrop-blur-sm border {{
                      button.borderColor
                    }} rounded-lg {{ button.textColor }} text-xs font-medium {{
                      button.hoverBgColor
                    }} transition-all duration-300 text-center"
                  >
                    {{ button.text }}
                  </button>
                </div>

                <!-- View More Button and Stats Row -->
                <div
                  class="flex items-center justify-between text-xs sm:text-sm pt-2 border-t border-gray-700/50 flex-shrink-0"
                >
                  <div
                    class="flex items-center space-x-2 text-gray-400 overflow-hidden"
                  >
                    <svg
                      class="w-4 h-4 flex-shrink-0"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        [attr.d]="project.stats.icon"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <span class="truncate">{{ project.stats.label }}</span>
                  </div>

                  <button
                    (click)="openProjectModal(project)"
                    (touchstart)="$event.stopPropagation()"
                    class="px-3 py-1.5 bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-400/30 rounded-lg text-blue-300 text-xs font-medium hover:from-blue-500/30 hover:to-purple-500/30 transition-all duration-300 whitespace-nowrap flex-shrink-0"
                  >
                    View More
                  </button>
                </div>
              </div>

              <!-- Dynamic Corner Decorations -->
              <div
                class="absolute -top-1 -left-1 w-3 h-3 border-l-2 border-t-2 {{
                  project.borderColors[0]
                }} opacity-0 group-hover:opacity-100 transition-opacity duration-500"
              ></div>
              <div
                class="absolute -top-1 -right-1 w-3 h-3 border-r-2 border-t-2 {{
                  project.borderColors[1]
                }} opacity-0 group-hover:opacity-100 transition-opacity duration-500"
              ></div>
              <div
                class="absolute -bottom-1 -left-1 w-3 h-3 border-l-2 border-b-2 {{
                  project.borderColors[2]
                }} opacity-0 group-hover:opacity-100 transition-opacity duration-500"
              ></div>
              <div
                class="absolute -bottom-1 -right-1 w-3 h-3 border-r-2 border-b-2 {{
                  project.borderColors[3]
                }} opacity-0 group-hover:opacity-100 transition-opacity duration-500"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons (for all devices) -->
    <div
      *ngIf="!isLoading && featuredProjects.length > 0"
      class="flex justify-center items-center space-x-4 mb-6 xs:mb-8 relative z-30"
    >
      <button
        (click)="prevSlide()"
        [disabled]="currentIndex === 0"
        class="p-2 xs:p-3 bg-gray-900/40 backdrop-blur-sm border border-gray-700/50 hover:border-blue-400/50 rounded-full text-white transition-all duration-300 hover:scale-110 disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
      >
        <svg
          class="w-4 h-4 xs:w-5 xs:h-5 text-blue-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>

      <button
        (click)="nextSlide()"
        [disabled]="currentIndex >= maxIndex"
        class="p-2 xs:p-3 bg-gray-900/40 backdrop-blur-sm border border-gray-700/50 hover:border-blue-400/50 rounded-full text-white transition-all duration-300 hover:scale-110 disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
      >
        <svg
          class="w-4 h-4 xs:w-5 xs:h-5 text-blue-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>
    </div>

    <!-- Carousel Indicators -->
    <div
      *ngIf="!isLoading && featuredProjects.length > 0"
      class="flex justify-center space-x-2 xs:space-x-3 mb-6 xs:mb-8"
    >
      <button
        *ngFor="let _ of getIndicatorArray(); let i = index"
        (click)="goToSlide(i)"
        class="w-2 h-2 xs:w-2.5 xs:h-2.5 sm:w-3 sm:h-3 rounded-full transition-all duration-300"
        [class]="
          currentIndex === i
            ? 'bg-blue-400 shadow-lg shadow-blue-400/50 scale-110'
            : 'bg-gray-600 hover:bg-gray-500 hover:scale-105'
        "
        [attr.aria-label]="'Go to slide ' + (i + 1)"
      ></button>
    </div>

    <!-- Mobile Swipe Instructions -->
    <div
      *ngIf="!isLoading && featuredProjects.length > 0"
      class="sm:hidden text-center mb-4"
    >
      <p
        class="text-gray-400 text-xs flex items-center justify-center space-x-2"
      >
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16l-4-4m0 0l4-4m-4 4h18"
          />
        </svg>
        <span>Swipe or use arrows to navigate</span>
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"
          />
        </svg>
      </p>
    </div>

    <!-- Floating Decorative Elements -->
    <div
      *ngIf="!isLoading"
      class="flex justify-center space-x-2 xs:space-x-3 sm:space-x-4 opacity-30"
    >
      <div
        class="w-1.5 h-1.5 xs:w-2 xs:h-2 bg-cyan-400/40 rounded-full animate-pulse"
      ></div>
      <div
        class="w-1 h-1 bg-blue-400/40 rounded-full animate-pulse"
        style="animation-delay: 0.5s"
      ></div>
      <div
        class="w-1.5 h-1.5 xs:w-2 xs:h-2 bg-purple-400/40 rounded-full animate-pulse"
        style="animation-delay: 1s"
      ></div>
    </div>

    <!-- Touch/Swipe Area for Mobile - Only on carousel track -->
    <div
      *ngIf="!isLoading && featuredProjects.length > 0"
      class="sm:hidden absolute pointer-events-none z-0"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd($event)"
      style="pointer-events: auto; top: 120px; left: 0; right: 0; bottom: 350px"
    ></div>
  </div>
</section>

<!-- Project Modal -->
<div
  *ngIf="isModalOpen && selectedProject"
  class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm transition-opacity duration-200"
  [class.opacity-0]="!isModalOpen"
  [class.opacity-100]="isModalOpen"
  (click)="closeProjectModal()"
>
  <div
    class="relative bg-gray-900/95 border border-gray-700/50 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transition-all duration-300"
    [class.scale-90]="!isModalOpen"
    [class.scale-100]="isModalOpen"
    (click)="$event.stopPropagation()"
  >
    <!-- Close Button -->
    <button
      (click)="closeProjectModal()"
      class="absolute top-4 right-4 z-10 p-2 bg-gray-800/80 hover:bg-gray-700/80 border border-gray-600 rounded-full text-gray-300 hover:text-white transition-all duration-300"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>

    <!-- Modal Content -->
    <div class="p-6 sm:p-8">
      <!-- Project Image -->
      <div class="relative overflow-hidden rounded-xl mb-6 h-[300px]">
        <div
          class="w-full h-full bg-gradient-to-br {{
            selectedProject.gradients.image
          }} flex items-center justify-center"
        >
          <div
            *ngIf="!selectedProject.image; else modalImage"
            class="text-8xl opacity-50"
          >
            {{ selectedProject.emoji }}
          </div>
          <ng-template #modalImage>
            <img
              [src]="selectedProject.image"
              [alt]="selectedProject.alt"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </ng-template>
        </div>
      </div>

      <!-- Project Title -->
      <h2
        class="text-3xl sm:text-4xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r {{
          selectedProject.gradients.title
        }}"
      >
        {{ selectedProject.title }}
      </h2>

      <!-- Project Description -->
      <div
        class="text-gray-300 leading-relaxed mb-6 text-base"
        [innerHTML]="selectedProject.description"
      ></div>

      <!-- Full Tech Stack -->
      <div class="mb-6">
        <h3 class="text-xl font-semibold text-gray-200 mb-3">
          Technologies Used
        </h3>
        <div class="flex flex-wrap gap-2">
          <span
            *ngFor="let tech of selectedProject.techStack"
            class="px-3 py-1.5 bg-gradient-to-r {{ tech.gradient }} border {{
              tech.borderColor
            }} rounded-full {{ tech.textColor }} text-sm font-medium {{
              tech.hoverGradient
            }} hover:scale-105 transition-all duration-300 backdrop-blur-sm"
          >
            {{ tech.name }}
          </span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-3">
        <button
          *ngFor="let button of selectedProject.buttons"
          (click)="onProjectButtonClick(selectedProject, button.text)"
          class="px-6 py-3 {{ button.bgColor }} backdrop-blur-sm border {{
            button.borderColor
          }} rounded-lg {{ button.textColor }} text-base font-medium {{
            button.hoverBgColor
          }} transition-all duration-300 hover:scale-105"
        >
          {{ button.text }}
        </button>
      </div>

      <!-- Project Stats -->
      <div
        class="mt-6 pt-6 border-t border-gray-700/50 flex items-center justify-between text-sm"
      >
        <div class="flex items-center space-x-2 text-gray-400">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              [attr.d]="selectedProject.stats.icon"
              clip-rule="evenodd"
            />
          </svg>
          <span>{{ selectedProject.stats.label }}</span>
        </div>
        <span [class]="selectedProject.stats.color + ' font-medium text-lg'">
          {{ selectedProject.year }}
        </span>
      </div>
    </div>
  </div>
</div>
